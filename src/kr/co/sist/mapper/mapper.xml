<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.sist.login">
	<resultMap type="kr.co.sist.domain.LoginCheckResult" id="LoginCheckResult">
		<result column="name" property="name"/>
		<result column="authority" property="authority"/>
	
	</resultMap>
  <select id="logincheck" resultMap="LoginCheckResult" parameterType="kr.co.sist.vo.LoginCheckVO">
    	select name, authority from admin where admin_id=#{id} and password=#{pass}
  </select>
  
  <select id="diaryTotalCnt" resultType="int">
		select count(*) cnt from INQUIRY_BOARD
	</select>
  
  
  <resultMap type="kr.co.sist.domain.InquiryList" id="ListResult">
		<result column="num" property="num"/>
		<result column="user_id" property="user_id"/>
		<result column="subject" property="subject"/>
		<result column="user_contents" property="user_contents"/>
		<result column="status" property="status"/>
		<result column="w_date" property="w_date"/>
		<result column="views" property="views"/>
	</resultMap>
  
  <select id="inquiryList" resultMap="ListResult" parameterType="kr.co.sist.vo.InquiryPageSetVO">
  
	 	SELECT NUM, USER_ID, SUBJECT, USER_CONTENTS, STATUS, to_char(W_DATE, 'yyyy-mm-dd') as w_date ,views
		FROM (SELECT NUM, USER_ID, SUBJECT, USER_CONTENTS, STATUS, W_DATE,views,
		ROW_NUMBER() OVER( ORDER BY to_number(num) desc ) AS R_NUM
		FROM INQUIRY_BOARD)
        WHERE R_NUM BETWEEN #{startNum} AND #{endNum } 
        
       
           
	</select>
  
  
   	<select id="inquiryDetail" parameterType="int" resultType="kr.co.sist.domain.InquiryDetail">
		select num ,user_id,subject,user_contents,status, to_char(w_date, 'yyyy-mm-dd dy hh24:mi') w_date
        from inquiry_board
        where num=#{num}
	</select>
	
<!-- 	
	<select id="diaryReply" resultType="kr.co.sist.domain.DiaryReply" parameterType="int">
		select num,writer,content,to_char(input_date,'yyyy-mm-dd hh24:mi') input_date
		from diary_reply
		where num_ref=#{num_ref}
		order by num desc
	</select> -->
	<!-- <insert id="insertReply" parameterType="kr.co.sist.vo.InquiryReplyVO">
		insert into inquiry_board(ADMIN_ID,R_CONTENTS,R_DATE)
		values(#{admin_id},#{r_contents},sysdate)
		
	</insert> --> 
	
	<update id="insertReply" parameterType="kr.co.sist.vo.InquiryReplyVO">
	update inquiry_board
	set ADMIN_ID =#{admin_id},
	R_CONTENTS=#{r_contents},
	R_DATE=sysdate,
	status='Y'
	where num = #{num}
	
	</update>
	
	<select id="readreply" parameterType="int" resultType="kr.co.sist.domain.InquiryReply">
	select admin_id,r_contents,to_char(r_DATE, 'yyyy-mm-dd') as r_date 
	from inquiry_board 
	where num=#{num}
	
	</select>
	<delete id="deleteUserInquiry" parameterType="int" >
	delete from inquiry_board
	where num = #{num}
	</delete>
	
	
  

</mapper>